(()=>{"use strict";var t={d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{acceleration:()=>E,angularAcceleration:()=>L,appearance:()=>Y,damage:()=>k,default:()=>N,friction:()=>U,generation:()=>C,health:()=>z,hitLine:()=>R,hitSphere:()=>T,label:()=>D,lifespan:()=>I,lineSegment:()=>A,orientation:()=>j,polyhedron:()=>x,position:()=>P,rotation:()=>O,stage:()=>V,thrust:()=>W,velocity:()=>M});var e=function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=document.createElement(t),o=0,a=Object.keys(r);o<a.length;o++){var i=a[o];n.setAttribute(i,r[i])}for(var l=0,c=Object.keys(e);l<c.length;l++){var u=c[l];n.style[u]=e[u]}return n};function n(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return o(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var a=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return n(Array(t).keys()).map((function(t){return t+r}))},i=function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return r.reduce((function(t,r){return t+r}),0)},l=function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return r[0].map((function(t,e){return r.map((function(t){return t[e]}))}))},c=function t(r,e){for(var n=r.filter((function(t){return e.includes(t)})),o=arguments.length,a=new Array(o>2?o-2:0),i=2;i<o;i++)a[i-2]=arguments[i];return a.length>0?t.apply(void 0,[n].concat(a)):n},u=function(){var t;return n(new Set((t=[]).concat.apply(t,arguments)))},d=["id"];function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function y(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function s(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?y(Object(e),!0).forEach((function(r){p(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):y(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function p(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function h(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function v(t){var r=function(t,r){if("object"!==f(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===f(r)?r:String(r)}var m=function(t,r){r in t.byId||console.warn("Missing item to remove",r);var e=t.byId,n=(e[r],h(e,[r].map(v)));return s(s({},t),{},{allIds:t.allIds.filter((function(t){return t!==r})),byId:n})},b=function(t,r){return r.id in t.byId||console.warn("Missing item to patch",r),s(s({},t),{},{byId:s(s({},t.byId),{},p({},r.id,s(s({},t.byId[r.id]),r)))})},g=function(t,r){return r.id in t.byId&&console.warn("Item already exists",r),s(s({},t),{},{allIds:u(t.allIds,r.id),byId:s(s({},t.byId),{},p({},r.id,s({},r)))})},w={allIds:[],byId:{}},S=function(t){var r=t.toUpperCase(),e="ADD_".concat(r),n="UPDATE_".concat(r),o="REMOVE_".concat(r),a="CLEAR_".concat(r),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,r=arguments.length>1?arguments[1]:void 0,a=r.type,i=r.payload,l=(i=void 0===i?{}:i).id,c=h(i,d);switch(a){case e:return g(t,s({id:l},c));case n:return b(t,s({id:l},c));case o:return m(t,l);default:return t}};return i.add=function(t,r){return{type:e,payload:s({id:t},r)}},i.update=function(t,r){return{type:n,payload:s({id:t},r)}},i.remove=function(t){return{type:o,payload:{id:t}}},i.clear=function(){return{type:a,payload:{}}},i},I=S("lifeSpan"),A=S("lineSegment"),P=S("position"),x=S("polyhedron"),O=S("rotation"),j=S("orientation"),M=S("velocity"),E=S("acceleration"),V=S("stage"),z=S("health"),k=S("damage"),T=S("hitSphere"),R=S("hitLine"),C=S("generation"),W=S("thrust"),U=S("friction"),L=S("angularAcceleration"),D=S("label"),Y=S("appearance");const N=($={stage:V,position:P,polyhedron:x,rotation:O,orientation:j,velocity:M,acceleration:E,lineSegment:A,lifespan:I,health:z,damage:k,hitSphere:T,hitLine:R,generation:C,thrust:W,friction:U,angularAcceleration:L,label:D,appearance:Y},function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return Object.keys($).reduce((function(e,n){return e[n]=$[n](t[n],r),e}),{})});var $;function J(t){return function(t){if(Array.isArray(t))return H(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return H(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return H(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,r)||q(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(t){return function(t){if(Array.isArray(t))return B(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||q(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(t,r){if(t){if("string"==typeof t)return B(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?B(t,r):void 0}}function B(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var G=function(t){return Math.sqrt(i.apply(void 0,F(t.map((function(t){return Math.pow(t,2)})))))},K=function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return r[0].map((function(t,e){return r.reduce((function(t,r){return t+r[e]}),0)}))},Q=function(t,r){return t.map((function(t,e){return t-r[e]}))},X=function(t,r){return r.map((function(r){return r*t}))},Z=function(t){var r=_(t,2),e=r[0],n=r[1];return[e*Math.cos(n),e*Math.sin(n)]},tt=function(t,r){var e=t.map((function(t,e){return t*r[e]}));return i.apply(void 0,F(e))},rt=function(t,r){var e=_(t,3),n=e[0],o=e[1],a=e[2],i=_(r,3),l=i[0],c=i[1],u=i[2];return[o*u-a*c,a*l-n*u,n*c-o*l]},et=function(t,r){return tt(t,r)/G(r)},nt=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,0,0],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,1,0];return[et(t,r),et(t,e)]},ot=function(t){return X(1/G(t),t)},at=function(t){return rt(Q(t[1],t[0]),Q(t[2],t[0]))},it=function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),n=1;n<r;n++)e[n-1]=arguments[n];var o=t.map((function(t,r){return X(t,e[r])}));return K.apply(void 0,F(o))},lt=function(t,r){return it.apply(void 0,[r].concat(F(l.apply(void 0,F(t)))))},ct=function(t,r){return t.map((function(t,e){return(t+r[e])/2}))},ut=function(t,r,e){return Math.max(r,Math.min(t,e))},dt=function(t,r,e,n,o){return t+(r-t)*((o-e)/(n-e))},ft=function(t,r){return Math.floor(Math.random()*(r-t+1)+t)},yt=function(t,r){return Math.random()*(r-t)+t},st=function(t,r){var e=r.fillStyle,n=r.strokeStyle,o=r.lineWidth;e&&(t.fillStyle=e,t.fill()),n&&o&&(t.strokeStyle=n,t.lineWidth=o,t.stroke())},pt=function(t,r,e,n){return function(o,a){return[t/2+t*o/e,r/2-r*a/n]}};function ht(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return vt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return vt(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}for(var mt,bt=[-1,2,4],gt=[1,0,0],wt=[0,1,0],St=[],It=256;It--;)St[It]=(It+256).toString(16).substring(1);function At(t){var r=0,e=t||11;if(!mt||It+e>512)for(mt="",It=0;r<256;r++)mt+=St[256*Math.random()|0];return mt.substring(It,It+++e)}function Pt(t){return function(t){if(Array.isArray(t))return xt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return xt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return xt(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Ot(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return jt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jt(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Mt=function(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}(r,["default"]);function Et(t){return function(t){if(Array.isArray(t))return Vt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return Vt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Vt(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var zt=function t(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===e)return r;var n=[];return r.forEach((function(t){var r=ot(ct(t[0],t[1])),e=ot(ct(t[1],t[2])),o=ot(ct(t[2],t[0]));n.push([t[0],r,o]),n.push([t[1],e,r]),n.push([t[2],o,e]),n.push([r,e,o])})),t(n,e-1)},kt=function(t){var r={};return t.map((function(t){return t.map((function(t){var e=JSON.stringify(t),n=r[e];return void 0===n&&(n=G(t)*yt(.7,1.2),r[e]=n),X(n,t)}))}))};const Tt=JSON.parse("[[[-0.5257311121191336,0.85065080835204,0],[-0.85065080835204,0,0.5257311121191336],[0,0.5257311121191336,0.85065080835204]],[[-0.5257311121191336,0.85065080835204,0],[0,0.5257311121191336,0.85065080835204],[0.5257311121191336,0.85065080835204,0]],[[-0.5257311121191336,0.85065080835204,0],[0.5257311121191336,0.85065080835204,0],[0,0.5257311121191336,-0.85065080835204]],[[-0.5257311121191336,0.85065080835204,0],[0,0.5257311121191336,-0.85065080835204],[-0.85065080835204,0,-0.5257311121191336]],[[-0.5257311121191336,0.85065080835204,0],[-0.85065080835204,0,-0.5257311121191336],[-0.85065080835204,0,0.5257311121191336]],[[0.5257311121191336,0.85065080835204,0],[0,0.5257311121191336,0.85065080835204],[0.85065080835204,0,0.5257311121191336]],[[0,0.5257311121191336,0.85065080835204],[-0.85065080835204,0,0.5257311121191336],[0,-0.5257311121191336,0.85065080835204]],[[-0.85065080835204,0,0.5257311121191336],[-0.85065080835204,0,-0.5257311121191336],[-0.5257311121191336,-0.85065080835204,0]],[[-0.85065080835204,0,-0.5257311121191336],[0,0.5257311121191336,-0.85065080835204],[0,-0.5257311121191336,-0.85065080835204]],[[0,0.5257311121191336,-0.85065080835204],[0.5257311121191336,0.85065080835204,0],[0.85065080835204,0,-0.5257311121191336]],[[0.5257311121191336,-0.85065080835204,0],[0.85065080835204,0,0.5257311121191336],[0,-0.5257311121191336,0.85065080835204]],[[0.5257311121191336,-0.85065080835204,0],[0,-0.5257311121191336,0.85065080835204],[-0.5257311121191336,-0.85065080835204,0]],[[0.5257311121191336,-0.85065080835204,0],[-0.5257311121191336,-0.85065080835204,0],[0,-0.5257311121191336,-0.85065080835204]],[[0.5257311121191336,-0.85065080835204,0],[0,-0.5257311121191336,-0.85065080835204],[0.85065080835204,0,-0.5257311121191336]],[[0.5257311121191336,-0.85065080835204,0],[0.85065080835204,0,-0.5257311121191336],[0.85065080835204,0,0.5257311121191336]],[[0,-0.5257311121191336,0.85065080835204],[0.85065080835204,0,0.5257311121191336],[0,0.5257311121191336,0.85065080835204]],[[-0.5257311121191336,-0.85065080835204,0],[0,-0.5257311121191336,0.85065080835204],[-0.85065080835204,0,0.5257311121191336]],[[0,-0.5257311121191336,-0.85065080835204],[-0.5257311121191336,-0.85065080835204,0],[-0.85065080835204,0,-0.5257311121191336]],[[0.85065080835204,0,-0.5257311121191336],[0,-0.5257311121191336,-0.85065080835204],[0,0.5257311121191336,-0.85065080835204]],[[0.85065080835204,0,0.5257311121191336],[0.85065080835204,0,-0.5257311121191336],[0.5257311121191336,0.85065080835204,0]]]"),Rt=JSON.parse("[[[1,0,0],[0,1,0],[0,0,1]],[[1,0,0],[0,0,-1],[0,1,0]],[[1,0,0],[0,0,1],[0,-1,0]],[[1,0,0],[0,-1,0],[0,0,-1]],[[-1,0,0],[0,0,1],[0,1,0]],[[-1,0,0],[0,1,0],[0,0,-1]],[[-1,0,0],[0,-1,0],[0,0,1]],[[-1,0,0],[0,0,-1],[0,-1,0]]]");function Ct(t){return function(t){if(Array.isArray(t))return Wt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return Wt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Wt(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Ut=function(t){switch(t){case 0:return[65,105,225];case 1:return[0,100,0];case 2:return[75,0,130];default:throw new Error("Unknown asteroid generation "+t)}},Lt=function(t,r,e){var n=e.cohort,o=void 0===n?0:n,a=e.xPos,i=e.yPos,l=e.zPos,c=void 0===l?0:l,u=At(),d=function(t){switch(t){case 0:return kt(zt(Tt,1)).map((function(t){return t.map((function(t){return X(8,t)}))}));case 1:return kt(zt(Rt,1)).map((function(t){return t.map((function(t){return X(6,t)}))}));case 2:return kt(zt(Tt,0)).map((function(t){return t.map((function(t){return X(4,t)}))}));default:throw new Error("Unknown asteroid generation "+t)}}(o),f=Math.max.apply(Math,Ct(d.map((function(t){return t.map((function(t){return G(t)}))})).flat())),y=Ut(o),s=Z([15*(o+1),yt(0,2*Math.PI)]);return r(P.add(u,{xPos:a,yPos:i,zPos:c})),r(j.add(u,{roll:0,pitch:yt(0,2*Math.PI),yaw:yt(0,2*Math.PI)})),r(O.add(u,{rollSpeed:yt(.5,2),pitchSpeed:0,yawSpeed:0})),r(M.add(u,{xVelocity:s[0],yVelocity:s[1],zVelocity:0})),r(z.add(u,{defence:1})),r(T.add(u,{radius:f})),r(x.add(u,{faces:d})),r(Y.add(u,{color:y})),r(C.add(u,{cohort:o})),u};const Dt=JSON.parse("[[[0,1,0],[0.8660254037844387,-0.5,0],[-0.8660254037844387,-0.5,0]],[[-0.8660254037844387,-0.5,0],[0.8660254037844387,-0.5,0],[0,1,0]]]");function Yt(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return Nt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Nt(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var $t=function(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}(r,["default"]);function Jt(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return Ht(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ht(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ht(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}const _t=JSON.parse('{"0":[[[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5],[1,-1.5]]],"1":[[[0,-1.5],[0,1.5]]],"2":[[[1,-1.5],[-1,-1.5],[-1,0],[1,0],[1,1.5],[-1,1.5]]],"3":[[[-1,-1.5],[1,-1.5],[1,1.5],[-1,1.5]],[[-1,0],[1,0]]],"4":[[[-1,1.5],[-1,0],[1,0]],[[1,-1.5],[1,1.5]]],"5":[[[-1,-1.5],[1,-1.5],[1,0],[-1,0],[-1,1.5],[1,1.5]]],"6":[[[-1,0],[1,0],[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5]]],"7":[[[-1,1.5],[1,1.5],[1,-1.5]]],"8":[[[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5],[1,-1.5]],[[-1,0],[1,0]]],"9":[[[1,0],[-1,0],[-1,1.5],[1,1.5],[1,-1.5]]],"A":[[[-1,-1.5],[-1,0.5],[0,1.5],[1,0.5],[1,-1.5]],[[-1,-0.3],[1,-0.3]]],"B":[[[-1,-1.5],[-1,1.5],[0.5,1.5],[1,1],[1,0.5],[0.5,0],[1,-0.5],[1,-1],[0.5,-1.5],[-1,-1.5]],[[-1,0],[0.5,0]]],"C":[[[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5]]],"D":[[[-1,-1.5],[-1,1.5],[0,1.5],[1,0.5],[1,-0.5],[0,-1.5],[-1,-1.5]]],"E":[[[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5]],[[-1,0],[0.5,0]]],"F":[[[-1,-1.5],[-1,1.5],[1,1.5]],[[-1,0],[0.5,0]]],"G":[[[0,-0.5],[1,-0.5],[1,-1.5],[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5],[1,0.5]]],"H":[[[-1,-1.5],[-1,1.5]],[[-1,0],[1,0]],[[1,-1.5],[1,1.5]]],"I":[[[-1,-1.5],[1,-1.5]],[[0,-1.5],[0,1.5]],[[-1,1.5],[1,1.5]]],"J":[[[-1,-0.5],[0,-1.5],[1,-1.5],[1,1.5]]],"K":[[[-1,-1.5],[-1,1.5]],[[0.8,-1.5],[-1,0],[0.8,1.5]]],"L":[[[1,-1.5],[-1,-1.5],[-1,1.5]]],"M":[[[-1,-1.5],[-1,1.5],[0,0.5],[1,1.5],[1,-1.5]]],"N":[[[-1,-1.5],[-1,1.5],[1,-1.5],[1,1.5]]],"O":[[[1,-1.5],[-1,-1.5],[-1,1.5],[1,1.5],[1,-1.5]]],"P":[[[-1,-1.5],[-1,1.5],[1,1.5],[1,0],[-1,0],[1,0]]],"Q":[[[-1,-1.5],[-1,1.5],[1,1.5],[1,-0.5],[0,-1.5],[-1,-1.5]],[[0,-0.5],[1,-1.5]]],"R":[[[-1,-1.5],[-1,1.5],[1,1.5],[1,0],[-1,0],[1,0]],[[-0.5,0],[1,-1.5]]],"S":[[[-1,-1.5],[1,-1.5],[1,0],[-1,0],[-1,1.5],[1,1.5]]],"T":[[[0,-1.5],[0,1.5]],[[-1,1.5],[1,1.5]]],"U":[[[1,1.5],[1,-1.5],[-1,-1.5],[-1,1.5]]],"V":[[[-1,1.5],[0,-1.5],[1,1.5]]],"W":[[[-1,1.5],[-1,-1.5],[0,-0.5],[1,-1.5],[1,1.5]]],"X":[[[-1,-1.5],[1,1.5]],[[-1,1.5],[1,-1.5]]],"Y":[[[-1,1.5],[0,0.5],[1,1.5]],[[0,-1.5],[0,0.5]]],"Z":[[[1,-1.5],[-1,-1.5],[1,1.5],[-1,1.5]]],":":[[[0,0.5],[0,0.5]],[[0,-0.5],[0,-0.5]]],"_":[[[-1,-1.5],[1,-1.5]]],"^":[[[0,-1.5],[-1,0.5],[-1,1],[-0.8,1.5],[-0.2,1.5],[0,1],[0.2,1.5],[0.8,1.5],[1,1],[1,0.5],[0,-1.5]]]}');function Ft(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,r)||Bt(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qt(t){return function(t){if(Array.isArray(t))return Gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Bt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bt(t,r){if(t){if("string"==typeof t)return Gt(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Gt(t,r):void 0}}function Gt(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}const Kt=JSON.parse("[[[4,0,0],[-2,2,0],[0,0,1]],[[-2,2,0],[-2,-2,0],[0,0,1]],[[-2,-2,0],[4,0,0],[0,0,1]]]");var Qt=function(t,r){var e=At();r(P.add(e,{xPos:0,yPos:0,zPos:0})),r(j.add(e,{roll:0,pitch:0,yaw:0})),r(O.add(e,{rollSpeed:0,pitchSpeed:0,yawSpeed:0,maxRoll:0,minRoll:0})),r(L.add(e,{rollAccel:0,pitchAccel:0,yawAccel:0,maxRollSpeed:8,maxPitchSpeed:0,maxYawSpeed:8,minYawSpeed:-8})),r(M.add(e,{xVelocity:0,yVelocity:0,zVelocity:0})),r(E.add(e,{xAccel:0,yAccel:0,zAccel:0,maxSpeed:100})),r(W.add(e,{power:0})),r(U.add(e,{inertia:15})),r(x.add(e,{faces:Kt})),r(Y.add(e,{color:[128,0,0]})),window.addEventListener("keydown",(function(n){if(!n.repeat&&("ArrowLeft"===n.code&&(r(L.update(e,{yawAccel:20,maxYawSpeed:6,rollAccel:-30,minRollSpeed:-6})),r(O.update(e,{minRoll:-.6}))),"ArrowRight"===n.code&&(r(L.update(e,{yawAccel:-20,minYawSpeed:-6,rollAccel:30,maxRollSpeed:6})),r(O.update(e,{maxRoll:.6}))),"ArrowUp"===n.code&&r(W.update(e,{power:160})),"Space"===n.code)){var o=t(),a=o.position,i=o.orientation,l=o.velocity,c=a.byId[e],u=c.xPos,d=c.yPos,f=i.byId[e].yaw,y=l.byId[e],s=y.xVelocity,p=y.yVelocity;!function(t,r,e){var n=e.xPos,o=e.yPos,a=e.yaw,i=e.xVelocity,l=void 0===i?0:i,c=e.yVelocity,u=void 0===c?0:c,d=At(),f=Z([4,a]),y=K([n,o],f),s=Z([200,a]),p=G([l,u])+150,h=Z([30,a]),v=K(h,[l,u]);r(P.add(d,{xPos:y[0],yPos:y[1]})),r(j.add(d,{yaw:a})),r(M.add(d,{xVelocity:v[0],yVelocity:v[1]})),r(E.add(d,{xAccel:s[0],yAccel:s[1],zAccel:0,speedLimit:p})),r(I.add(d,{ttl:1200})),r(A.add(d,{length:4})),r(Y.add(d,{pixelWidth:4,color:[189,183,107]})),r(k.add(d,{attack:1})),r(R.add(d,{length:4}))}(0,r,{xPos:u,yPos:d,xVelocity:s,yVelocity:p,yaw:f})}})),window.addEventListener("deviceorientation",(function(n){var o=n.beta,a=n.gamma,i=screen.availHeight>screen.availWidth?a:o;if(i<-10&&(r(L.update(e,{yawAccel:20,maxYawSpeed:6,rollAccel:-30,minRollSpeed:-6})),r(O.update(e,{minRoll:-.6}))),i>10&&(r(L.update(e,{yawAccel:-20,minYawSpeed:-6,rollAccel:30,maxRollSpeed:6})),r(O.update(e,{maxRoll:.6}))),i>=-10&&i<=10){var l=t().rotation.byId[e].yawSpeed;l>0?(r(L.update(e,{yawAccel:-20,minYawSpeed:0,rollAccel:30})),r(O.update(e,{maxRoll:0}))):l<0&&(r(L.update(e,{yawAccel:20,maxYawSpeed:0,rollAccel:-30})),r(O.update(e,{minRoll:0})))}})),window.addEventListener("keyup",(function(t){"ArrowLeft"===t.code&&(r(L.update(e,{yawAccel:-20,minYawSpeed:0,rollAccel:30})),r(O.update(e,{maxRoll:0}))),"ArrowRight"===t.code&&(r(L.update(e,{yawAccel:20,maxYawSpeed:0,rollAccel:-30})),r(O.update(e,{minRoll:0}))),"ArrowUp"===t.code&&r(W.update(e,{power:0}))}))},Xt=function(t,r,e){var n=e.xPos,o=e.yPos,a=e.text,i=e.size,l=void 0===i?2:i,c=e.alignment,u=void 0===c?"left":c,d=e.color,f=void 0===d?[255,255,255]:d,y=e.lineWidth,s=void 0===y?4:y,p=At();return r(P.add(p,{xPos:n,yPos:o})),r(D.add(p,{text:a,size:l,alignment:u})),r(Y.add(p,{color:f,lineWidth:s})),p};function Zt(t){return function(t){if(Array.isArray(t))return tr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return tr(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return tr(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tr(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var rr=function(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}(r,["default"]);function er(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function nr(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?er(Object(e),!0).forEach((function(r){or(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):er(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function or(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var ar,ir,lr,cr,ur,dr=At(),fr={width:1920,height:1080},yr={width:256,height:144},sr=(ar=N,lr=[],(cr=function(t){ir=ar(ir,t),lr.forEach((function(t){return t()}))})({}),{getState:function(){return ir},dispatch:cr,subscribe:function(t){return lr.push(t),function(){t=t.filter((function(r){return r!==t}))}}}),pr=function(t){var r,e,n=[],o=performance.now(),a=(r=function(){var r=performance.now(),e=r-o;n.forEach((function(r){return r(t.getState,t.dispatch,e)})),o=r},function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];e&&cancelAnimationFrame(e),e=requestAnimationFrame((function(){r.apply(void 0,n)}))});return{addTask:function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return n=[].concat(J(n),r),function(){n=n.filter((function(t){return t!==r.includes(t)}))}},run:a}}(sr),hr=e("canvas",nr({id:"game-layer"},fr),{position:"absolute",backgroundColor:"#333"}),vr=e("div",{id:"stage"},nr({position:"relative"},fr));vr.appendChild(hr),document.body.appendChild(vr),sr.subscribe(pr.run),pr.addTask((function(t,r,e){var n=t(),o=n.rotation,a=n.angularAcceleration,i=c(o.allIds,a.allIds),l=e/1e3;i.forEach((function(t){var e=o.byId[t],n=e.rollSpeed,i=void 0===n?0:n,c=e.pitchSpeed,u=void 0===c?0:c,d=e.yawSpeed,f=void 0===d?0:d,y=a.byId[t],s=y.rollAccel,p=void 0===s?0:s,h=y.pitchAccel,v=void 0===h?0:h,m=y.yawAccel,b=void 0===m?0:m,g=y.maxRollSpeed,w=void 0===g?1/0:g,S=y.maxPitchSpeed,I=void 0===S?1/0:S,A=y.maxYawSpeed,P=void 0===A?1/0:A,x=y.minYawSpeed,j=void 0===x?-1/0:x;if(0!==p||0!==v||0!==b){var M=i+p*l,E=u+v*l,V=f+b*l;M=Math.abs(M)>w?w*(M<0?-1:1):M,E=Math.abs(E)>I?I*(E<0?-1:1):E,V=b<0?Math.max(V,j):Math.min(V,P),r(O.update(t,{rollSpeed:M,pitchSpeed:E,yawSpeed:V}))}}))}),(function(t,r,e){var n=t(),o=n.orientation,a=n.rotation,i=c(o.allIds,a.allIds),l=e/1e3;i.forEach((function(t){var e=o.byId[t],n=e.roll,i=e.pitch,c=e.yaw,u=a.byId[t],d=u.rollSpeed,f=u.pitchSpeed,y=u.yawSpeed,s=u.maxRoll,p=void 0===s?1/0:s,h=u.minRoll,v=void 0===h?-1/0:h;0!==y&&r(j.update(t,{yaw:c+y*l})),0!==f&&r(j.update(t,{pitch:i+f*l})),0!==d&&(d<0&&n>=v&&r(j.update(t,{roll:n+d*l})),d>0&&n<=p&&r(j.update(t,{roll:n+d*l})))}))}),(function(t,r,e){var n=t(),o=n.thrust,i=n.acceleration,l=n.orientation,u=n.velocity,d=n.position;c(o.allIds,i.allIds,l.allIds).forEach((function(t){var n=o.byId[t].power,i=l.byId[t].yaw,c=d.byId[t],f=c.xPos,y=c.yPos,s=u.byId[t],p=s.xVelocity,h=s.yVelocity,v=n*Math.cos(i),m=n*Math.sin(i);r(E.update(t,{xAccel:v,yAccel:m})),n>0&&a(Math.floor(e/8)).forEach((function(t){!function(t,r,e){var n=e.xPos,o=e.yPos,a=e.yaw,i=e.xVelocity,l=void 0===i?0:i,c=e.yVelocity,u=At(),d=[255,ft(0,169),0],f=ft(200,400),y=Z([200,a]);r(P.add(u,{xPos:n,yPos:o})),r(j.add(u,{yaw:a})),r(M.add(u,{xVelocity:l,yVelocity:c})),r(E.add(u,{xAccel:y[0],yAccel:y[1],zAccel:0})),r(I.add(u,{ttl:f,fadeOut:.5*f})),r(A.add(u,{length:2})),r(Y.add(u,{pixelWidth:4,color:d}))}(0,r,{xPos:f,yPos:y,xVelocity:p,yVelocity:h,yaw:i-Math.PI+yt(-.15,.15)})}))}))}),(function(t,r,e){var n=t(),o=n.velocity,a=n.acceleration,i=c(o.allIds,a.allIds),l=e/1e3;i.forEach((function(t){var e=o.byId[t],n=e.xVelocity,i=void 0===n?0:n,c=e.yVelocity,u=void 0===c?0:c,d=a.byId[t],f=d.xAccel,y=void 0===f?0:f,s=d.yAccel,p=void 0===s?0:s,h=d.maxSpeed,v=void 0===h?1/0:h;if(0!==y||0!==p){var m=[i+y*l,u+p*l],b=G(m);b>v&&(m=X(v/b,m)),r(M.update(t,{xVelocity:m[0],yVelocity:m[1]}))}}))}),(function(t,r,e){var n=t(),o=n.velocity,a=n.friction,i=c(o.allIds,a.allIds),l=e/1e3;i.forEach((function(t){var e=o.byId[t],n=e.xVelocity,i=void 0===n?0:n,c=e.yVelocity,u=void 0===c?0:c,d=(e.zVelocity,a.byId[t].inertia),f=[i,u],y=G(f);if(y>0){var s=Math.max(0,y-d*l),p=Jt(X(s/y,f),2),h=p[0],v=p[1];r(M.update(t,{xVelocity:h,yVelocity:v}))}}))}),(ur=dr,function(t,r,e){var n=t(),o=n.position,a=n.velocity,i=n.stage,l=c(o.allIds,a.allIds),u=e/1e3,d=i.byId[ur],f=d.localWidth,y=d.localHeight,s=f/2,p=y/2,h=10;l.forEach((function(t){var e=o.byId[t],n=e.xPos,i=void 0===n?0:n,l=e.yPos,c=void 0===l?0:l,d=e.zPos,v=void 0===d?0:d,m=a.byId[t],b=m.xVelocity,g=void 0===b?0:b,w=m.yVelocity,S=void 0===w?0:w,I=m.zVelocity,A=void 0===I?0:I;if(0!==g){var x=i+g*u;x<-s-h&&(x+=f+20),x>s&&(x-=f+20),r(P.update(t,{xPos:x}))}if(0!==S){var O=c+S*u;O<-p-h&&(O+=y+20),O>p+h&&(O-=y+20),r(P.update(t,{yPos:O}))}0!==A&&r(P.update(t,{zPos:v+A*u}))}))}),(function(t,r,e){var n=t(),o=n.position,a=n.orientation,i=n.damage,l=n.hitLine,u=n.health,d=n.hitSphere,f=n.polyhedron,y=n.lifespan,s=c(o.allIds,a.allIds,i.allIds,l.allIds,y.allIds),p=c(o.allIds,a.allIds,u.allIds,d.allIds,f.allIds),h=s.map((function(t){var r=o.byId[t],e=r.xPos,n=r.yPos,i=a.byId[t].yaw,c=l.byId[t].length;return{coords:[].concat(Et(K(Z([c,i]),[e,n])),[0]),id:t}})),v=[];h.forEach((function(t){var r=t.coords;p.forEach((function(e){var n,a,i=o.byId[e],l=i.xPos,c=i.yPos,u=i.zPos,f=d.byId[e].radius;n={x:r[0],y:r[1],z:r[2]},a={x:l,y:c,z:u,radius:f},Math.sqrt((n.x-a.x)*(n.x-a.x)+(n.y-a.y)*(n.y-a.y)+(n.z-a.z)*(n.z-a.z))<a.radius&&v.push({targetId:e,projectileId:t.id})}))})),v.forEach((function(t){var e=t.projectileId,n=t.targetId,l=o.byId[e],c=l.xPos,d=l.yPos,y=a.byId[e].yaw,s=i.byId[e].attack,p=f.byId[n].faces,h=o.byId[n],v=u.byId[n].defence;p.map((function(t){return t.map((function(t){return K([h.xPos,h.yPos,h.zPos],t)}))})).forEach((function(t){var o=function(t,r,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,o=1e-7,a=e[0],i=e[1],l=e[2],c=Q(i,a),u=Q(l,a),d=rt(r,u),f=tt(c,d);if(f>-o&&f<o)return null;var y=1/f,s=Q(t,a),p=y*tt(s,d);if(p<0||p>1)return null;var h=rt(s,c),v=y*tt(r,h);if(v<0||p+v>1)return null;var m=y*tt(u,h);return m>o&&m<n?K(t,X(m,r)):null}([c,d,0],[0,0,y],t);o&&(r(I.update(e,{ttl:0})),r(z.update(n,{defence:v-s})))}))}))}),(function(t,r,e){var n=t(),o=n.lifespan,a=n.appearance;c(o.allIds,a.allIds).forEach((function(t){var i=o.byId[t],l=i.ttl,c=i.fadeOut,u=void 0===c?NaN:c;if((l-=e)<=0)Object.keys(Mt).forEach((function(e){void 0!==n[e].byId[t]&&r(Mt[e].remove(t))}));else{if(!isNaN(u)){var d=Math.min(1,l/u),f=Ot(a.byId[t].color,3),y=f[0],s=f[1],p=f[2];r(Y.update(t,{color:[y,s,p,d]}))}r(I.update(t,{ttl:l}))}}))}),(function(t,r,e){var n=t(),o=n.generation,i=n.position,l=n.health;c(i.allIds,o.allIds,l.allIds).forEach((function(t){if(0===l.byId[t].defence){var e=o.byId[t].cohort,c=i.byId[t],u=c.xPos,d=c.yPos;Object.keys($t).forEach((function(e){void 0!==n[e].byId[t]&&r($t[e].remove(t))})),a(10*(3-e)).forEach((function(t){!function(t,r,e){var n=e.xPos,o=e.yPos,a=e.zPos,i=void 0===a?0:a,l=e.rgb,c=void 0===l?[65,105,225]:l,u=At(),d=yt(1.2,1.5),f=kt(Dt.map((function(t){return t.map((function(t){return X(d,t)}))}))),y=Yt(Z([yt(40,80),yt(0,2*Math.PI)]),2),s=y[0],p=y[1],h=yt(400,600);r(P.add(u,{xPos:n,yPos:o,zPos:i})),r(j.add(u,{roll:0,pitch:yt(0,2*Math.PI),yaw:yt(0,2*Math.PI)})),r(O.add(u,{rollSpeed:yt(6,10),pitchSpeed:0,yawSpeed:0})),r(M.add(u,{xVelocity:s,yVelocity:p})),r(E.add(u,{xAccel:-s,yAccel:-p,zAccel:0})),r(I.add(u,{ttl:h,fadeOut:.2*h})),r(x.add(u,{faces:f})),r(Y.add(u,{color:c}))}(0,r,{xPos:u,yPos:d,rgb:Ut(e)})})),e<2&&a(2).forEach((function(t){Lt(0,r,{cohort:e+1,xPos:u,yPos:d})}))}}))}),function(t){return function(r,e,n){var o=r().stage.byId[t],a=o.ctx,i=o.width,l=o.height;a.clearRect(0,0,i,l)}}(dr),function(t){return function(r,e,n){var o=r(),a=o.label,i=o.position,l=o.appearance,u=o.stage,d=c(a.allIds,i.allIds,l.allIds),f=u.byId[t],y=f.ctx,s=f.width,p=f.height,h=f.localWidth,v=f.localHeight,m=pt(s,p,h,v);d.forEach((function(t){var r=a.byId[t],e=r.text,n=r.size,o=r.alignment,c=l.byId[t],u=c.color,d=c.lineWidth,f=void 0===d?1:d,s=i.byId[t],p=s.xPos,h=s.yPos,v=["center"===o?e.length*n/2*-3:"right"===o?e.length*n*-3:0,0,0],b=qt(e).map((function(t,r){var e=[p+3*r*n,h];return(_t[t.toUpperCase()]||[]).map((function(t){return t.map((function(t){var r=Ft(K(X(n,t),e,v),2),o=r[0],a=r[1];return m(o,a)}))}))})).flat(),g="rgb(".concat(u.join(","),")");y.save(),y.lineJoin="round",y.lineCap="round",function(t,r){t.beginPath(),r.forEach((function(r){t.moveTo(r[0][0],r[0][1]);for(var e=1;e<r.length;e++)t.lineTo(r[e][0],r[e][1])}))}(y,b),st(y,{lineWidth:f,strokeStyle:g}),y.restore()}))}}(dr),function(t){return function(r,e,n){var o=r(),a=o.lineSegment,i=o.appearance,l=o.position,u=o.orientation,d=o.stage;c(a.allIds,l.allIds,u.allIds,i.allIds).forEach((function(r){var e=a.byId[r].length,n=i.byId[r],o=n.pixelWidth,c=n.color,f=void 0===c?[0,0,0]:c,y=u.byId[r].yaw,s=d.byId[t],p=s.ctx,h=s.width,v=s.height,m=s.localWidth,b=s.localHeight,g=pt(h,v,m,b),w=l.byId[r],S=K(Z([e,y]),[w.xPos,w.yPos]),I="rgb(".concat(f.join(","),")");p.save(),function(t,r,e){t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(e[0],e[1])}(p,g(w.xPos,w.yPos),g.apply(void 0,Pt(S))),st(p,{lineWidth:o,strokeStyle:I}),p.restore()}))}}(dr),function(t){return function(r,e,n){var o=r(),a=o.polyhedron,i=o.position,l=o.orientation,u=o.appearance,d=o.stage,f=c(a.allIds,i.allIds,l.allIds,u.allIds),y=function(t,r){return t.id!==r.id?r.id-t.id:t.face[0][2]-r.face[0][2]},s=[];f.forEach((function(t){var r=a.byId[t].faces,e=u.byId[t].color,n=l.byId[t],o=n.roll,i=n.pitch,c=n.yaw;r.forEach((function(r,n){if(r=r.map((function(t){return function(t,r,e,n){var o=[[Math.cos(t)*Math.cos(r),Math.cos(t)*Math.sin(r)*Math.sin(e)-Math.sin(t)*Math.cos(e),Math.cos(t)*Math.sin(r)*Math.cos(e)+Math.sin(t)*Math.sin(e)],[Math.sin(t)*Math.cos(r),Math.sin(t)*Math.sin(r)*Math.sin(e)+Math.cos(t)*Math.cos(e),Math.sin(t)*Math.sin(r)*Math.cos(e)-Math.cos(t)*Math.sin(e)],[-Math.sin(r),Math.cos(r)*Math.sin(e),Math.cos(r)*Math.cos(e)]];return lt(o,n)}(c,i,o,t)})),at(r)[2]>0){var a=function(t,r){for(var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t,r){return t-r},n=0,o=t.length;n<o;){var a=Math.floor((n+o)/2);e(t[a],r)<0?n=a+1:o=a}return n}(s,{id:t,face:r},y);!function(t,r,e){t.splice(r,0,e)}(s,a,{id:t,face:r,color:e})}}))}));var p=d.byId[t],h=p.ctx,v=p.width,m=p.height,b=p.localWidth,g=p.localHeight,w=pt(v,m,b,g);s.forEach((function(t){var r=t.id,e=t.face,n=function(t,r){var e=0;r>0?e=dt(0,80,0,1,r):r<0&&(e=dt(-100,0,-1,0,r));var n=ut(t[0]+Math.floor(e/100*255),0,255),o=ut(t[1]+Math.floor(e/100*255),0,255),a=ut(t[2]+Math.floor(e/100*255),0,255);return 3===t.length?"rgba(".concat(n,",").concat(o,",").concat(a,")"):"rgba(".concat(n,",").concat(o,",").concat(a,",").concat(t[3],")")}(t.color,tt(ot(at(e)),ot(bt))),o=i.byId[r],a=o.xPos,l=o.yPos,c=o.zPos,u=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,0,0],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,1,0];return t.map((function(t){return nt(t,r,e)}))}(e.map((function(t){return K([a,l,c],t)})),gt,wt).map((function(t){var r=ht(t,2),e=r[0],n=r[1];return w(e,n)}));h.save(),function(t,r){t.beginPath(),t.moveTo(r[0][0],r[0][1]);for(var e=1;e<r.length;e++)t.lineTo(r[e][0],r[e][1]);t.closePath()}(h,u),st(h,{lineWidth:1,strokeStyle:n,fillStyle:n}),h.restore()}))}}(dr)),function(t,r,e){var n=e.canvasElement,o=e.world,a=e.id,i=n.getContext("2d"),l=n.width,c=n.height;n.style.transformOrigin="0 0";var u=function(){var t=window.innerWidth/l,r=window.innerHeight/c,e=Math.min(t,r);n.style.transform="scale("+e+")"};u(),window.addEventListener("resize",u),r(V.add(a,{ctx:i,width:l,height:c,localWidth:o.width,localHeight:o.height}))}(sr.getState,sr.dispatch,{id:dr,canvasElement:hr,world:yr});var mr=function(t,r){var e=r.width/2,n=r.height/2,o=[];o[0]=Xt(t.getState,t.dispatch,{text:"Asteroids 3D",xPos:0,yPos:45,size:4,lineWidth:8,alignment:"center"}),o[1]=Xt(t.getState,t.dispatch,{text:"Rotate left: Tilt device left or press arrow left key",xPos:0,yPos:15,size:1,alignment:"center"}),o[2]=Xt(t.getState,t.dispatch,{text:"Rotate right: Tilt device right or press arrow right key",xPos:0,yPos:5,size:1,alignment:"center"}),o[3]=Xt(t.getState,t.dispatch,{text:"Thrust: Tap left part of screen or press arrow up key ",xPos:0,yPos:-5,size:1,alignment:"center"}),o[4]=Xt(t.getState,t.dispatch,{text:"Fire missile: Tap right part of screen or press space bar",xPos:0,yPos:-15,size:1,alignment:"center"}),o[5]=Xt(t.getState,t.dispatch,{text:"Tap screen or press any key to start",xPos:0,yPos:-45,size:2,lineWidth:6,alignment:"center"}),o[6]=Xt(t.getState,t.dispatch,{text:"Vanilla JS Asteroids clone built with ^ and low poly 3D graphics by Claudijo Borovic 2022",xPos:0,yPos:-65,size:.75,lineWidth:2,alignment:"center"});var i=a(6).map((function(r){var o=ft(-e,e),a=ft(-n,n);return Lt(t.getState,t.dispatch,{cohort:r%3,xPos:o,yPos:a})}));return function(){var r=t.getState();[].concat(o,Zt(i)).forEach((function(e){Object.keys(rr).forEach((function(n){void 0!==r[n].byId[e]&&t.dispatch(rr[n].remove(e))}))}))}}(sr,yr),br=function t(r){mr(),function(t,r){Qt(t.getState,t.dispatch);var e=r.width/2,n=r.height/2;a(5).forEach((function(r){var o=ft(-e,e),a=ft(-n,n);Lt(t.getState,t.dispatch,{cohort:0,xPos:o,yPos:a})}))}(sr,yr),window.removeEventListener("keydown",t),hr.removeEventListener("touchstart",t)};window.addEventListener("keydown",br),hr.addEventListener("touchstart",br)})();
//# sourceMappingURL=main.eb629018a82d0adfb5ea.js.map